--CREATE DATABASE QuanLyCuaHang;
----https://cafedev.vn/tu-hoc-sql-bai-tap-thuc-hanh-create-insert-update-xoa-du-lieu-trong-sql/
USE QuanLyCuaHang
--select * from KHACHHANG WHERE KHACHHANG.DCHI LIKE '%Q5%'
--select HOTEN, SODT from KHACHHANG --where DOANHSO > 300000
--select * from KHACHHANG where DCHI LIKE '%Q5%' OR DCHI LIKE '%Q1%'

--select MASP from SANPHAM
--except
--select MASP from CTHD

--select * from HOADON,KHACHHANG WHERE HOADON.MAKH = KHACHHANG.MAKH

--select MASP from SANPHAM
--intersect
--select MASP from CTHD

--SELECT * FROM SANPHAM
--SELECT * FROM CTHD
--select * from SANPHAM JOIN CTHD on SANPHAM.MASP = CTHD.MASP
--select KHACHHANG.MAKH,KHACHHANG.HOTEN,SOHD from KHACHHANG right join HOADON on KHACHHANG.MAKH = HOADON.MAKH

--select KHACHHANG.MAKH,KHACHHANG.HOTEN,SOHD
--from KHACHHANG right join HOADON
--on KHACHHANG.MAKH = HOADON.MAKH

--select NHANVIEN.MANV, NHANVIEN.HOTEN, HOADON.SOHD from NHANVIEN left join HOADON
--on NHANVIEN.MANV = HOADON.MANV

--select * from NHANVIEN left join HOADON
--on NHANVIEN.MANV = HOADON.MANV
--where HOADON.SOHD is not null

select NHANVIEN.MANV, NHANVIEN.HOTEN from NHANVIEN

select HOADON.MANV from HOADON

--CREATE TABLE KHACHHANG(
--MAKH char(4) PRIMARY KEY,
--HOTEN varchar(40),
--DCHI varchar(50),
--SODT varchar(20),
--NGSINH smalldatetime,
--DOANHSO money,
--NGDK smalldatetime,
--)
--CREATE TABLE NHANVIEN(
--MANV char(4) PRIMARY KEY,
--HOTEN varchar(40),
--SODT varchar(20),
--NGVL smalldatetime,
--)
--CREATE TABLE SANPHAM(
--MASP char(4) PRIMARY KEY,
--TENSP varchar(40),
--DVT varchar(20),
--NUOCSX varchar(40),
--GIA money,
--)
--CREATE TABLE HOADON(
--SOHD int PRIMARY KEY,
--NGHD smalldatetime,
--MAKH char(4),
--MANV char(4),
--TRIGIA money,
--)
--CREATE TABLE CTHD(
--SOHD int,
--MASP char(4),
--SL int,
--PRIMARY KEY (SOHD, MASP)
--);

--INSERT INTO NHANVIEN VALUES ('NV01', 'Nguyen Nhu Nhut', 0927345678, '4/13/2006')
--INSERT INTO NHANVIEN VALUES ('NV02', 'Le Thi Phi Yen', 0987567390, '4/21/2006')
--INSERT INTO NHANVIEN VALUES ('NV03', 'Nguyen Van B', 0997047382, '4/27/2006')
--INSERT INTO NHANVIEN VALUES ('NV04', 'Ngo Thanh Tuan', 0913758498, '6/24/2006')
--INSERT INTO NHANVIEN VALUES ('NV05', 'Nguyen Thi Truc Thanh', 0918590387, '7/20/2006')


--INSERT INTO KHACHHANG VALUES ('KH01', 'Nguyen Van A', '731 Tran Hung Dao, Q5, TpHCM', 08823451, '10/22/1960', '13060000', '7/22/2006')
--INSERT INTO KHACHHANG VALUES ('KH02', 'Tran Ngoc Han', '23/5 Nguyen Trai, Q5, TpHCM', 0908256478, '4/3/1974', '280000', '7/30/2006')
--INSERT INTO KHACHHANG VALUES ('KH03', 'Tran Ngoc Linh', '45 Nguyen Canh Chan, Q1, TpHCM', 0938776266, '6/12/1980', '3860000', '8/5/2006')
--INSERT INTO KHACHHANG VALUES ('KH04', 'Tran Minh Long', '50/34 Le Dai Hanh, Q10, TpHCM', 0917325476, '3/9/1965', '250000', '10/2/2006')
--INSERT INTO KHACHHANG VALUES ('KH05', 'Le Nhat Minh', '34 Truong Dinh, Q3, TpHCM', 08246108, '3/10/1950', '21000', '10/28/2006')
--INSERT INTO KHACHHANG VALUES ('KH06', 'Le Hoai Thuong', '227 Nguyen Van Cu, Q5, TpHCM', 08631738, '12/31/1981', '915000', '11/24/2006')
--INSERT INTO KHACHHANG VALUES ('KH07', 'Nguyen Van Tam', '32/3 Tran Binh Trong, Q5, TpHCM', 0916783565, '6/4/1971', '12500', '12/1/2006')
--INSERT INTO KHACHHANG VALUES ('KH08', 'Phan Thi Thanh', '45/2 An Duong Vuong, Q5, TpHCM', 0938435756, '1/10/1971', '365000', '12/13/2006')
--INSERT INTO KHACHHANG VALUES ('KH09', 'Le Ha Vinh', '837 Le Hong Phong, Q5, TpHCM', 08654763, '9/3/1979', '70000', '1/14/2007')
--INSERT INTO KHACHHANG VALUES ('KH10', 'Ha Duy Lap', '34/34B Nguyen Trai, Q1, TpHCM', 08768904, '5/2/1983', '67500', '1/16/2007')
--SELECT * FROM KHACHHANG

--INSERT INTO SANPHAM VALUES ('BC01', 'But chi', 'cay', 'Singapore', 3000)
--INSERT INTO SANPHAM VALUES ('BC02', 'But chi', 'cay', 'Singapore', 5000)
--INSERT INTO SANPHAM VALUES ('BC03', 'But chi', 'cay', 'Viet Nam', 3500)
--INSERT INTO SANPHAM VALUES ('BC04', 'But chi', 'hop', 'Viet Nam', 30000)
--INSERT INTO SANPHAM VALUES ('BB01', 'But bi', 'cay', 'Viet Nam', 5000)
--INSERT INTO SANPHAM VALUES ('BB02', 'But bi', 'cay', 'Trung Quoc', 7000)
--INSERT INTO SANPHAM VALUES ('BB03', 'But bi', 'hop', 'Thai Lan', 100000)
--INSERT INTO SANPHAM VALUES ('TV01', 'Tap 100 giay mong', 'quyen', 'Trung Quoc', 2500)
--INSERT INTO SANPHAM VALUES ('TV02', 'Tap 200 giay mong', 'quyen', 'Trung Quoc', 2500)
--INSERT INTO SANPHAM VALUES ('TV03', 'Tap 100 giay tot', 'quyen', 'Viet Nam', 3000)
--INSERT INTO SANPHAM VALUES ('TV04', 'Tap 200 giay tot', 'quyen', 'Viet Nam', 5500)
--INSERT INTO SANPHAM VALUES ('TV05', 'Tap 100 trang', 'chuc', 'Viet Nam', 23000)
--INSERT INTO SANPHAM VALUES ('TV06', 'Tap 200 trang', 'chuc', 'Viet Nam', 53000)
--INSERT INTO SANPHAM VALUES ('TV07', 'Tap 100 trang', 'chuc', 'Trung Quoc', 34000)
--INSERT INTO SANPHAM VALUES ('ST01', 'So tay 500 trang', 'quyen', 'Trung Quoc', 40000)
--INSERT INTO SANPHAM VALUES ('ST02', 'So tay loai 1', 'quyen', 'Viet Nam', 55000)
--INSERT INTO SANPHAM VALUES ('ST03', 'So tay loai 2', 'quyen', 'Viet Nam', 51000)
--INSERT INTO SANPHAM VALUES ('ST04', 'So tay', 'quyen', 'Thai Lan', 55000)
--INSERT INTO SANPHAM VALUES ('ST05', 'So tay mong', 'quyen', 'Thai Lan', 20000)
--INSERT INTO SANPHAM VALUES ('ST06', 'Phan viet bang', 'hop', 'Viet Nam', 5000)
--INSERT INTO SANPHAM VALUES ('ST07', 'Phan khong bui', 'hop', 'Viet Nam', 7000)
--INSERT INTO SANPHAM VALUES ('ST08', 'Bong bang', 'cai', 'Viet Nam', 1000)
--INSERT INTO SANPHAM VALUES ('ST09', 'But long', 'cay', 'Viet Nam', 5000)
--INSERT INTO SANPHAM VALUES ('ST10', 'But long', 'cay', 'Trung Quoc', 7000)
--SELECT * FROM SANPHAM

--INSERT INTO HOADON VALUES (1001, '7/23/2006', 'KH01', 'NV01', 320000)
--INSERT INTO HOADON VALUES (1002, '8/12/2006', 'KH01', 'NV02', 840000)
--INSERT INTO HOADON VALUES (1003, '8/23/2006', 'KH02', 'NV01', 100000)
--INSERT INTO HOADON VALUES (1004, '9/1/2006',  'KH02', 'NV01', 180000)
--INSERT INTO HOADON VALUES (1005, '10/20/2006','KH01', 'NV02', 3800000)
--INSERT INTO HOADON VALUES (1006, '10/16/2006','KH01', 'NV03', 2430000)
--INSERT INTO HOADON VALUES (1007, '10/28/2006','KH03', 'NV03', 510000)
--INSERT INTO HOADON VALUES (1008, '10/16/2006','KH01', 'NV03', 440000)
--INSERT INTO HOADON VALUES (1009, '10/28/2006','KH03', 'NV04', 200000)
--INSERT INTO HOADON VALUES (1010, '11/1/2006', 'KH01', 'NV01', 5200000)
--INSERT INTO HOADON VALUES (1011, '11/4/2006', 'KH04', 'NV03', 250000)
--INSERT INTO HOADON VALUES (1012, '11/30/2006','KH05', 'NV03', 21000)
--INSERT INTO HOADON VALUES (1013, '12/12/2006','KH06', 'NV01', 5000)
--INSERT INTO HOADON VALUES (1014, '31/12/2006','KH03', 'NV02', 3150000)
--INSERT INTO HOADON VALUES (1015, '1/1/2007',  'KH06', 'NV01', 910000)
--INSERT INTO HOADON VALUES (1016, '1/1/2007',  'KH07', 'NV02', 12500)
--INSERT INTO HOADON VALUES (1017, '1/2/2007',  'KH08', 'NV03', 35000)
--INSERT INTO HOADON VALUES (1018, '1/13/2007', 'KH08', 'NV03', 330000)
--INSERT INTO HOADON VALUES (1019, '1/13/2007', 'KH01', 'NV03', 30000)
--INSERT INTO HOADON VALUES (1020, '1/14/2007', 'KH09', 'NV04', 70000)
--INSERT INTO HOADON VALUES (1021, '1/16/2007', 'KH10', 'NV03', 67500)
--INSERT INTO HOADON VALUES (1022, '1/16/2007',  null,  'NV03', 7000)
--INSERT INTO HOADON VALUES (1023, '1/17/2007',  null,  'NV01', 330000)
--SELECT * FROM HOADON


--INSERT INTO CTHD VALUES (1001, 'TV02', 10)
--INSERT INTO CTHD VALUES (1001, 'ST01', 5)
--INSERT INTO CTHD VALUES (1001, 'BC01', 5)
--INSERT INTO CTHD VALUES (1001, 'BC02', 10)
--INSERT INTO CTHD VALUES (1001, 'ST08', 10)
--INSERT INTO CTHD VALUES (1002, 'BC04', 20)
--INSERT INTO CTHD VALUES (1002, 'BB01', 20)
--INSERT INTO CTHD VALUES (1002, 'BB02', 20)
--INSERT INTO CTHD VALUES (1003, 'BB03', 10)
--INSERT INTO CTHD VALUES (1004, 'TV01', 20)
--INSERT INTO CTHD VALUES (1004, 'TV02', 10)
--INSERT INTO CTHD VALUES (1004, 'TV03', 10)
--INSERT INTO CTHD VALUES (1004, 'TV04', 10)
--INSERT INTO CTHD VALUES (1005, 'TV05', 50)
--INSERT INTO CTHD VALUES (1005, 'TV06', 50)
--INSERT INTO CTHD VALUES (1006, 'TV07', 20)
--INSERT INTO CTHD VALUES (1006, 'ST01', 30)
--INSERT INTO CTHD VALUES (1006, 'ST02', 10)
--INSERT INTO CTHD VALUES (1007, 'ST03', 10)
--INSERT INTO CTHD VALUES (1008, 'ST04', 8)
--INSERT INTO CTHD VALUES (1009, 'ST05', 10)
--INSERT INTO CTHD VALUES (1010, 'TV07', 50)
--INSERT INTO CTHD VALUES (1010, 'ST07', 50)
--INSERT INTO CTHD VALUES (1010, 'ST08', 100)
--INSERT INTO CTHD VALUES (1010, 'ST04', 50)
--INSERT INTO CTHD VALUES (1010, 'TV03', 100)
--INSERT INTO CTHD VALUES (1011, 'ST06', 50)
--INSERT INTO CTHD VALUES (1012, 'ST07', 3)
--INSERT INTO CTHD VALUES (1013, 'ST08', 5)
--INSERT INTO CTHD VALUES (1014, 'BC02', 80)
--INSERT INTO CTHD VALUES (1014, 'BB02', 100)
--INSERT INTO CTHD VALUES (1014, 'BC04', 60)
--INSERT INTO CTHD VALUES (1014, 'BB01', 50)
--INSERT INTO CTHD VALUES (1015, 'BB02', 30)
--INSERT INTO CTHD VALUES (1015, 'BB03', 7)
--INSERT INTO CTHD VALUES (1016, 'TV01', 5)
--INSERT INTO CTHD VALUES (1017, 'TV02', 1)
--INSERT INTO CTHD VALUES (1017, 'TV03', 1)
--INSERT INTO CTHD VALUES (1017, 'TV04', 5)
--INSERT INTO CTHD VALUES (1018, 'ST04', 6)
--INSERT INTO CTHD VALUES (1019, 'ST05', 1)
--INSERT INTO CTHD VALUES (1019, 'ST06', 2)
--INSERT INTO CTHD VALUES (1020, 'ST07', 10)
--INSERT INTO CTHD VALUES (1021, 'ST08', 5)
--INSERT INTO CTHD VALUES (1021, 'TV01', 7)
--INSERT INTO CTHD VALUES (1021, 'TV02', 10)
--INSERT INTO CTHD VALUES (1022, 'ST07', 1)
--INSERT INTO CTHD VALUES (1023, 'ST04', 6)
--select * from CTHD


--ALTER TABLE SANPHAM ADD GHICHU varchar(20)
--ALTER TABLE KHACHHANG ADD LOAIKH tinyint
--UPDATE KHACHHANG SET KHACHHANG.HOTEN = 'Nguyen Van B' WHERE KHACHHANG.MAKH = 'KH01'
--select * from KHACHHANG where MAKH='KH01'

--select * from KHACHHANG where MAKH='KH09'
--UPDATE KHACHHANG SET [NGDK] = DATEFROMPARTS(2007, MONTH([NGDK]), DAY([NGDK])) WHERE MAKH='KH09';
--SELECT * FROM KHACHHANG

--ALTER TABLE SANPHAM ALTER COLUMN GHICHU varchar(100);

--ALTER TABLE SANPHAM DROP COLUMN GHICHU

--SELECT * FROM KHACHHANG WHERE YEAR(KHACHHANG.NGSINH)='1971'
--DELETE KHACHHANG WHERE YEAR(KHACHHANG.NGSINH)='1971'

--SELECT * FROM KHACHHANG WHERE YEAR(KHACHHANG.NGSINH)=1971 AND YEAR(KHACHHANG.NGDK)=2006
--DELETE


--1.............................................
--SELECT dbo.SANPHAM.MASP, dbo.SANPHAM.TENSP FROM SANPHAM WHERE dbo.SANPHAM.NUOCSX='Trung Quoc'
--2.............................................
--SELECT dbo.SANPHAM.MASP, dbo.SANPHAM.TENSP FROM SANPHAM WHERE dbo.SANPHAM.DVT='cay' OR dbo.SANPHAM.DVT='quyen';
--3.............................................
--SELECT dbo.SANPHAM.MASP, dbo.SANPHAM.TENSP FROM SANPHAM WHERE dbo.SANPHAM.MASP LIKE 'B%01';
--4.............................................
--SELECT MASP,TENSP FROM SANPHAM WHERE SANPHAM.NUOCSX='Trung Quoc' AND (SANPHAM.GIA >= 30000 AND SANPHAM.GIA <= 40000);
--5.............................................
--SELECT * FROM SANPHAM WHERE (GIA>=30000 AND GIA<=40000) AND (NUOCSX='Trung Quoc' OR NUOCSX='Thai Lan');
--6.............................................
--SELECT SOHD FROM dbo.HOADON WHERE NGHD='1/1/2007' OR NGHD='1/2/2007';
--7.............................................
--SELECT SOHD,TRIGIA FROM HOADON WHERE YEAR(NGHD)='2007' AND MONTH(NGHD)='1' ORDER BY NGHD ASC, TRIGIA DESC
--8.............................................
--SELECT KHACHHANG.MAKH, KHACHHANG.HOTEN
--FROM KHACHHANG, HOADON
--WHERE KHACHHANG.MAKH = HOADON.MAKH AND HOADON.NGHD='1/1/2007'
--9.............................................
--SELECT HOADON.SOHD,HOADON.TRIGIA FROM HOADON,NHANVIEN
--WHERE NHANVIEN.HOTEN='Nguyen Van B' AND HOADON.NGHD='10/28/2006';
--10............................................
--SELECT SANPHAM.MASP,SANPHAM.TENSP
--FROM (KHACHHANG JOIN HOADON ON KHACHHANG.MAKH=HOADON.MAKH)
--	JOIN (SANPHAM JOIN CTHD ON SANPHAM.MASP=CTHD.MASP) ON HOADON.SOHD=CTHD.SOHD
--WHERE KHACHHANG.HOTEN='Nguyen Van A' AND YEAR(HOADON.NGHD)='2006' AND MONTH(HOADON.NGHD)='10';
--11............................................
--SELECT dbo.CTHD.SOHD FROM dbo.CTHD WHERE dbo.CTHD.MASP='BB01' OR dbo.CTHD.MASP='BB02'
--12............................................
--SELECT SOHD FROM CTHD WHERE (SL>=10 AND SL<=20) AND (MASP='BB01' OR MASP='BB02')
--SELECT SOHD FROM CTHD WHERE MASP IN ('BB01', 'BB02') AND SL BETWEEN 10 AND 20
--13............................................
--SELECT DISTINCT dbo.HOADON.SOHD
--FROM dbo.HOADON, dbo.CTHD
--WHERE HOADON.SOHD = CTHD.SOHD AND CTHD.MASP='BB01' AND SL BETWEEN 10 AND 20
--INTERSECT
--SELECT DISTINCT dbo.HOADON.SOHD
--FROM dbo.HOADON, dbo.CTHD
--WHERE HOADON.SOHD = CTHD.SOHD AND CTHD.MASP='BB02' AND SL BETWEEN 10 AND 20
--14............................................
--SELECT *
--FROM SANPHAM sp, HOADON hd, CTHD ct
--WHERE sp.NUOCSX='Trung Quoc' AND hd.SOHD=ct.SOHD AND hd.NGHD='1/1/2007' AND sp.MASP=ct.MASP
--15............................................
--SELECT DISTINCT sp.MASP,sp.TENSP
--FROM SANPHAM sp, CTHD ct
--WHERE sp.MASP NOT IN (SELECT CTHD.MASP FROM CTHD)
--16............................................
--SELECT sp.MASP,sp.TENSP
--FROM SANPHAM sp
--WHERE sp.MASP NOT IN (SELECT CTHD.MASP
--					  FROM CTHD,HOADON
--					  WHERE CTHD.SOHD=HOADON.SOHD AND YEAR(HOADON.NGHD)=2006)

--SELECT *--sp.MASP, sp.TENSP
--FROM SANPHAM sp
--WHERE NOT EXISTS (SELECT ct.MASP FROM CTHD ct WHERE sp.MASP=ct.MASP)
--17............................................
--SELECT sp.MASP, sp.TENSP FROM SANPHAM sp
--WHERE sp.MASP NOT IN (SELECT ct.MASP FROM CTHD ct, HOADON hd
--				WHERE sp.NUOCSX='Trung Quoc' AND YEAR(hd.NGHD)=2006)
--18............................................
--SELECT DISTINCT ct.SOHD FROM CTHD ct, SANPHAM sp
--WHERE ct.MASP=SP.MASP AND sp.NUOCSX='Singapore' AND ct.SOHD=

--SELECT SOHD
--FROM HOADON
--WHERE
--NOT EXISTS
--(
--    SELECT *
--    FROM SANPHAM
--    WHERE NUOCSX= 'Singapore' AND MASP NOT IN
--    (
--        SELECT masp
--        FROM CTHD
--        WHERE SOHD = HOADON.SOHD and CTHD.MASP = SANPHAM.MASP
--    )
--)
--19............................................